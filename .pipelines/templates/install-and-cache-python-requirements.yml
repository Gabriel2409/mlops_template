parameters:
  # variables are automatically exported as environment variables
  # so this will override pip's default cache dir
  - name: pip_cache_dir
    type: string
    default: $(Pipeline.Workspace)/.pip

steps:
  - task: Cache@2
    displayName: Cache pip
    inputs:
      key: 'pip | "$(Agent.OS)" | requirements.txt'
      path: $(pip_cache_dir)
      cacheHitVar: cache_restored

  - script: |
      echo "Cache Hit, skipping installing requirements
    displayName: Cach Hit
    condition: eq(variables.cache_restored, 'tru')

  - script: |
      echo "Cache miss, installing dependencies"
      pip install -r requirements.txt
    displayName: Install dependencies
    condition: eq(variables.cache_restored, 'false')
