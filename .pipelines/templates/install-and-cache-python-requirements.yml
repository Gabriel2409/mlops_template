parameters:
  - name: pip_cache_dir
    type: string
    default: $(Pipeline.Workspace)/.pip

steps:
  - script: mkdir -p ${{ parameters.pip_cache_dir }}
    displayName: 'Create Cache Directory'
  - task: Cache@2
    displayName: Check for cached dependencies
    inputs:
      key: 'pip | "$(Agent.OS)" | requirements.txt'
      path: ${{ parameters.pip_cache_dir }}
      cacheHitVar: cache_restored

  - script: |
      if [ "$(cache_restored)" == "true" ]; then
        echo "Cache hit! Skipping installation of requirements."
      else
        echo "Cache miss! Installing dependencies..."
        pip install -r requirements.txt
      fi
    displayName: 'Install or Skip Dependencies'
