parameters:
  # variables are automatically exported as environment variables
  # so this will override pip's default cache dir
  - name: pip_cache_dir
    type: string
    default: $(Pipeline.Workspace)/.pip

steps:
  - task: Cache@2
    displayName: Cache pip
    inputs:
      key: 'pip | "$(Agent.OS)" | requirements.txt'
      path: ${{ parameters.pip_cache_dir }}
      cacheHitVar: cache_restored

  - script: |
      if [ "$(cache_restored)" == "true" ]; then
        echo "Cache hit! Skipping installation of requirements."
      else
        echo "Cache miss! Installing dependencies..."
        pip install -r requirements.txt
      fi
    displayName: 'Install or Skip Dependencies'
